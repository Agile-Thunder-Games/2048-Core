(()=>{var e={680:(e,t,i)=>{var s;void 0===(s=function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Direction=void 0,(i=t.Direction||(t.Direction={}))[i.Up=0]="Up",i[i.Right=1]="Right",i[i.Down=2]="Down",i[i.Left=3]="Left"}.apply(t,[i,t]))||(e.exports=s)},681:(e,t,i)=>{var s,r;s=[i,t,i(768),i(236)],void 0===(r=function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0,t.Game=class{constructor(e,t,i,s){this.size=e,this.inputManager=t,this.storageManager=i,this.actuator=s,this.startTiles=2}run(){this.inputManager.on("move",this.move.bind(this)),this.inputManager.on("restart",this.restart.bind(this)),this.inputManager.on("keepPlaying",this.keepPlaying.bind(this)),this.setup()}restart(){this.storageManager.clearGameState(),this.actuator.continueGame(),this.setup()}keepPlaying(){this.isPlaying=!0,this.actuator.continueGame()}get isGameTerminated(){return this.over||this.won&&!this.isPlaying}setup(){let e=this.storageManager.gameState;e?(this.grid=new i.Grid(e.grid.size,e.grid.cells),this.score=e.score,this.over=e.over,this.won=e.won,this.keepPlaying=e.keepPlaying):(this.grid=new i.Grid(this.size,null),this.score=0,this.over=!1,this.won=!1,this.isPlaying=!1,this.addStartTiles()),this.actuate()}addStartTiles(){for(let e=0;e<this.startTiles;e++)this.addRandomTile()}addRandomTile(){if(this.grid.isCellsAvailable()){let e;e=Math.random()<.9?2:4;let t=new s.Tile(this.grid.randomAvailableCell(),e);this.grid.insertTile(t)}}actuate(){this.storageManager.bestScore<this.score&&(this.storageManager.bestScore=this.score),this.over?this.storageManager.clearGameState():this.storageManager.gameState=this.serialize(),this.actuator.actuate(this.grid,{score:this.score,over:this.over,won:this.won,bestScore:this.storageManager.bestScore,terminated:this.isGameTerminated})}serialize(){return{grid:this.grid.serialize(),score:this.score,over:this.over,won:this.won,keepPlaying:this.keepPlaying}}prepareTiles(){this.grid.eachCell(((e,t,i)=>{i&&(i.mergedFrom=null,i.savePosition())}))}moveTile(e,t){this.grid.cells[e.x][e.y]=null,this.grid.cells[t.x][t.y]=e,e.updatePosition(t)}move(e){if(this.isGameTerminated)return;let t,i,r=this.getVector(e),a=this.buildTraversals(r),o=!1;this.prepareTiles();for(let e of a.x)for(let n of a.y)if(t={x:e,y:n},i=this.grid.cellContent(t),i){let e=this.findFarthestPosition(t,r),a=this.grid.cellContent(e.next);if(a&&a.value===i.value&&!a.mergedFrom){let t=new s.Tile(e.next,2*i.value);t.mergedFrom=[i,a],this.grid.insertTile(t),this.grid.removeTile(i),i.updatePosition(e.next),this.score+=t.value,2048===t.value&&(this.won=!0)}else this.moveTile(i,e.farthest);this.positionsEquals(t,i)||(o=!0)}o&&(this.addRandomTile(),this.isMovesAvailable()||(this.over=!0),this.actuate())}getVector(e){return[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}][e]}buildTraversals(e){let t={x:[],y:[]};for(let e=0;e<this.size;e++)t.x.push(e),t.y.push(e);return 1===e.x&&(t.x=t.x.reverse()),1===e.y&&(t.y=t.y.reverse()),t}findFarthestPosition(e,t){let i;do{i=e,e={x:i.x+t.x,y:i.y+t.y}}while(this.grid.withinBounds(e)&&this.grid.isCellAvailable(e));return{farthest:i,next:e}}isMovesAvailable(){return this.grid.isCellsAvailable()||this.isTileMatchesAvailable()}isTileMatchesAvailable(){let e;for(let t=0;t<this.size;t++)for(let i=0;i<this.size;i++)if(e=this.grid.cellContent({x:t,y:i}),e)for(let s=0;s<4;s++){let r=this.getVector(s),a={x:t+r.x,y:i+r.y},o=this.grid.cellContent(a);if(o&&o.value===e.value)return!0}return!1}positionsEquals(e,t){return e.x===t.x&&e.y===t.y}}}.apply(t,s))||(e.exports=r)},768:(e,t,i)=>{var s,r;s=[i,t,i(236)],void 0===(r=function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Grid=void 0,t.Grid=class{constructor(e,t){this.size=e,this.cells=t?this.fromState(t):this.empty()}empty(){let e=[];for(let t=0;t<this.size;t++){let i=e[t]=[];for(let e=0;e<this.size;e++)i.push(null)}return e}fromState(e){let t=[];for(let s=0;s<this.size;s++){let r=t[s]=[];for(let t=0;t<this.size;t++){let a=e[s][t];a?r.push(new i.Tile(a.position,a.value)):r.push(null)}}return t}randomAvailableCell(){let e=this.availableCells();if(e.length)return e[Math.floor(Math.random()*e.length)]}availableCells(){let e=[];return this.eachCell(((t,i,s)=>{s||e.push({x:t,y:i})})),e}eachCell(e){for(let t=0;t<this.size;t++)for(let i=0;i<this.size;i++)e(t,i,this.cells[t][i])}isCellsAvailable(){return!!this.availableCells().length}isCellAvailable(e){return!this.isCellOccupied(e)}isCellOccupied(e){return!!this.cellContent(e)}cellContent(e){return this.withinBounds(e)?this.cells[e.x][e.y]:null}insertTile(e){this.cells[e.x][e.y]=e}removeTile(e){this.cells[e.x][e.y]=null}withinBounds(e){return e.x>=0&&e.x<this.size&&e.y>=0&&e.y<this.size}serialize(){let e=[];for(let t=0;t<this.size;t++){let i=e[t]=[];for(let e=0;e<this.size;e++)this.cells[t][e]?i.push(this.cells[t][e].serialize()):i.push(null)}return{size:this.size,cells:e}}get size(){return this._size}set size(e){this._size=e}get cells(){return this._cells}set cells(e){this._cells=e}get previousState(){return this._previousState}set previousState(e){this._previousState=e}}}.apply(t,s))||(e.exports=r)},160:(e,t,i)=>{var s;void 0===(s=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlActuator=void 0,t.HtmlActuator=class{constructor(){this.tileContainer=document.querySelector(".tile-container"),this.scoreContainer=document.querySelector(".score-container"),this.bestContainer=document.querySelector(".best-container"),this.gridContainer=document.querySelector(".grid-container"),this.gameContainer=document.querySelector(".game-message"),this.score=0,this.createCells()}createCells(){let e,t;for(let i=0;i<4;i++){e=document.createElement("div"),e.className="grid-row";for(let i=0;i<4;i++)t=document.createElement("div"),t.className="grid-cell",e.appendChild(t);this.gridContainer.appendChild(e)}}actuate(e,t){window.requestAnimationFrame((()=>{this.clearContainer(this.tileContainer);for(let t of e.cells)for(let e of t)e&&this.addTile(e);this.updateScore(t.score),this.updateBestScore(t.bestScore),t.terminated&&(t.won?this.message(!0):this.message(!1))}))}continueGame(){this.clearMessage()}clearContainer(e){for(;e.firstChild;)e.removeChild(e.firstChild)}addTile(e){let t=document.createElement("div"),i=document.createElement("div"),s=e.previousPosition||{x:e.x,y:e.y},r=this.positionClass(s),a=["tile",`tile-${e.value}`,r];if(e.value>2048&&a.push("tile-super"),this.applyClasses(t,a),i.classList.add("tile-inner"),i.innerHTML=e.value.toString(),e.previousPosition)window.requestAnimationFrame((()=>{a[2]=this.positionClass({x:e.x,y:e.y}),this.applyClasses(t,a)}));else if(e.mergedFrom){a.push("tile-merged"),this.applyClasses(t,a);for(let t of e.mergedFrom)this.addTile(t)}else a.push("tile-new"),this.applyClasses(t,a);t.appendChild(i),this.tileContainer.appendChild(t)}applyClasses(e,t){e.className=t.join(" ")}normalizePosition(e){return{x:e.x+1,y:e.y+1}}positionClass(e){return`tile-position-${(e=this.normalizePosition(e)).x}-${e.y}`}updateScore(e){this.clearContainer(this.scoreContainer),this.score=e,this.scoreContainer.innerHTML=this.score.toString()}updateBestScore(e){this.bestContainer.innerHTML=e.toString()}message(e){let t,i;e?(i="game-won",t="You win!"):(i="game-over",t="Game over!"),this.gameContainer.classList.add(i),this.gameContainer.querySelector(".message").innerHTML=t}clearMessage(){this.gameContainer.classList.remove("game-won"),this.gameContainer.classList.remove("game-over")}}}.apply(t,[i,t]))||(e.exports=s)},894:(e,t,i)=>{var s,r;s=[i,t,i(680)],void 0===(r=function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardInputManager=void 0,t.KeyboardInputManager=class{constructor(){this.events=[],window.navigator.msPointerEnabled?(this.eventTouchStart="MSPointerDown",this.eventTouchMove="MSPointerMove",this.eventTouchEnd="MSPointerUp"):(this.eventTouchStart="touchstart",this.eventTouchMove="touchmove",this.eventTouchEnd="touchend"),this.listen()}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}emit(e,t){let i=this.events[e];if(i)for(let e of i)e(t)}listen(){let e,t;document.addEventListener("keydown",(e=>{let t;if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey))switch(e.keyCode){case 37:t=i.Direction.Left;break;case 38:t=i.Direction.Up;break;case 39:t=i.Direction.Right;break;case 40:t=i.Direction.Down}void 0!==typeof t&&(e.preventDefault(),this.emit("move",t))})),this.bindButtonPress(".retry-button",this.restart),this.bindButtonPress(".restart-button",this.restart),this.bindButtonPress(".keep-playing-button",this.keepPlaying);let s=document.querySelector(".game-container");s.addEventListener(this.eventTouchStart,(i=>{window.navigator.msPointerEnabled?(e=i.pageX,t=i.pageY):(e=i.touches[0].clientX,t=i.touches[0].clientY),i.preventDefault()})),s.addEventListener(this.eventTouchMove,(e=>e.preventDefault())),s.addEventListener(this.eventTouchEnd,(i=>{let s,r;window.navigator.msPointerEnabled?(s=i.pageX,r=i.pageY):(s=i.changedTouches[0].clientX,r=i.changedTouches[0].clientY);let a=s-e,o=Math.abs(a),n=r-t,l=Math.abs(n);Math.max(o,l)>10&&this.emit("move",o>l?a>0?1:3:n>0?2:0)}))}restart(e){e.preventDefault(),this.emit("restart",null)}keepPlaying(e){e.preventDefault(),this.emit("keepPlaying",null)}bindButtonPress(e,t){let i=document.querySelector(e);i.addEventListener("click",t.bind(this)),i.addEventListener(this.eventTouchEnd,t.bind(this))}}}.apply(t,s))||(e.exports=r)},569:(e,t,i)=>{var s;void 0===(s=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageManager=void 0,t.LocalStorageManager=class{constructor(){this.bestScoreKey="bestScore",this.gameStateKey="gameState",this.storage=window.localStorage}clearGameState(){this.storage.removeItem(this.gameStateKey)}get bestScore(){return this.storage.getItem(this.bestScoreKey)||0}set bestScore(e){this.storage.setItem(this.bestScoreKey,e.toString())}get gameState(){let e=this.storage.getItem(this.gameStateKey);return e?JSON.parse(e):null}set gameState(e){this.storage.setItem(this.gameStateKey,JSON.stringify(e))}}}.apply(t,[i,t]))||(e.exports=s)},236:(e,t,i)=>{var s;void 0===(s=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tile=void 0,t.Tile=class{constructor(e,t){this.x=e.x,this.y=e.y,this.value=t||2,this.previousPosition=null,this.mergedFrom=null}savePosition(){this.previousPosition={x:this.x,y:this.y}}updatePosition(e){this.x=e.x,this.y=e.y}serialize(){return{position:{x:this.x,y:this.y},value:this.value}}get position(){return this._position}set position(e){this._position=e}get value(){return this._value}set value(e){this._value=e}get previousPosition(){return this._previousPosition}set previousPosition(e){this._previousPosition=e}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}get mergedFrom(){return this._mergedFrom}set mergedFrom(e){this._mergedFrom=e}}}.apply(t,[i,t]))||(e.exports=s)},929:(e,t,i)=>{var s,r;s=[i,t,i(894),i(569),i(160),i(681)],void 0===(r=function(e,t,i,s,r,a){"use strict";const o=new i.KeyboardInputManager,n=new s.LocalStorageManager,l=new r.HtmlActuator;new a.Game(4,o,n,l).run()}.apply(t,s))||(e.exports=r)}},t={};!function i(s){if(t[s])return t[s].exports;var r=t[s]={exports:{}};return e[s](r,r.exports,i),r.exports}(929)})();